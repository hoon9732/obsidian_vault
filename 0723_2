# app/mts/common/localization.py 
import json
from pathlib import Path
from PySide6.QtCore import QObject, Signal

class Localization(QObject):
    """Load & serve translated strings; notify on language switch."""
    language_changed = Signal(str)

    def __init__(self, locale_path: str):
        super().__init__()
        self._load(locale_path)

    def _load(self, locale_path: str):
        path = Path(locale_path)
        with path.open(encoding="utf-8") as f:
            self._strings = json.load(f)
        self._current = path.name

    def get(self, key: str) -> str:
        """Return translation for `key`, or `key` if missing."""
        return self._strings.get(key, key)

    def switch(self, locale_path: str):
        """Reload from new JSON and emit change signal."""
        self._load(locale_path)
        self.language_changed.emit(locale_path)

# app/mts/common/theme_manager.py
import json
from pathlib import Path
from PySide6.QtCore import QObject, Signal
from PySide6.QtWidgets import QApplication

class ThemeManager(QObject):
    """Load & apply a theme JSON to the QApplication; notify on switch."""
    theme_changed = Signal(str)

    def __init__(self, theme_path: str):
        super().__init__()
        self._load(theme_path)

    def _load(self, theme_path: str):
        path = Path(theme_path)
        with path.open(encoding="utf-8") as f:
            self._theme = json.load(f)
        self._current = path.name

    def apply(self, app: QApplication):
        """Generate and set a Qt stylesheet based on loaded theme."""
        bg   = self._theme.get("background", "#FFFFFF")
        fg   = self._theme.get("text",       "#000000")
        font = self._theme.get("font",       "Arial")
        size = self._theme.get("fontSize",   12)
        stylesheet = f"""
            * {{
                background-color: {bg};
                color: {fg};
                font-family: '{font}';
                font-size: {size}px;
            }}
        """
        app.setStyleSheet(stylesheet)

    def switch(self, theme_path: str, app: QApplication):
        """Reload new theme, re-apply, and emit change signal."""
        self._load(theme_path)
        self.apply(app)
        self.theme_changed.emit(theme_path)

# app/mts/common/theme_manager.py
import qtvscodestyle as qtvsc
from PySide6.QtCore import QObject, Signal
from PySide6.QtWidgets import QApplication
from PySide6.QtCore import Qt

class ThemeManager(QObject):
    """Apply VS Codeâ€“style themes (via QtVSCodeStyle) to the QApplication."""
    theme_changed = Signal(str)

    def __init__(self, theme_name: str):
        """
        :param theme_name: name of a Theme enum, e.g. 'DARK_VS' or 'LIGHT_VS'
        """
        super().__init__()
        # Normalize to qtvsc.Theme member
        try:
            self._theme = getattr(qtvsc.Theme, theme_name)
        except AttributeError:
            # default to DARK_VS if unknown
            self._theme = qtvsc.Theme.DARK_VS

    def apply(self, app: QApplication):
        """Load & set the VSCode-style stylesheet on the app."""
        # ensure high-DPI icons (recommended by QtVSCodeStyle)
        app.setAttribute(Qt.AA_UseHighDpiPixmaps)
        stylesheet = qtvsc.load_stylesheet(self._theme)
        app.setStyleSheet(stylesheet)

    def switch(self, theme_name: str, app: QApplication):
        """Change theme at runtime."""
        try:
            self._theme = getattr(qtvsc.Theme, theme_name)
        except AttributeError:
            return  # ignore invalid names
        self.apply(app)
        self.theme_changed.emit(theme_name)